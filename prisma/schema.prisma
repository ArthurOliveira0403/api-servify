generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      =  env("DATABASE_URL")
}

model Address {
  company_id String  @unique
  country    String?
  state      String?
  city       String?
  street     String?
  number     String?
  zip_code   String?
  complement String?

  company Company @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@map("address")
}

model Company {
  id              String   @id @default(uuid())
  name            String?
  email           String   @unique 
  password        String   
  cnpj            String?  @unique
  address         Address?
  phone_number    String?
  role            UserRole @default(COMPANY)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  services        Service[]
  subscriptions   Subscription[]
  @@map("company")
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
}

model Subscription {
  id           String             @id @default(uuid())
  company_id   String          
  plan_id      String
  price        Int
  status       SubscriptionStatus
  start_date   DateTime
  end_date     DateTime
  renewal_date DateTime

  company      Company            @relation(fields: [company_id], references: [id], onDelete: Cascade)
  plan         Plan               @relation(fields: [plan_id], references: [id], onDelete: Cascade)
  @@map("subscription")
}

enum PlanType {
  MONTHLY
  YEARLY
}

model Plan {
  id            String         @id
  name          String         @unique
  type          PlanType
  price         Int
  description   String
  subscriptions Subscription[]

  @@map("plan")
}

enum ServiceStatus {
  PENDING 
  IN_PROGRESS 
  DONE 
  CANCELED
}

model Service {
  id          String        @id @default(uuid())
  company_id  String 
  client_id   String
  description String
  status      ServiceStatus @default(PENDING)
  price       Int
  start_at    DateTime?
  finished_at DateTime?
  created_at  DateTime      @default(now())
  updated_at  DateTime      @updatedAt

  company     Company       @relation(fields: [company_id], references: [id], onDelete: Cascade)
  client      Client        @relation(fields: [client_id], references: [id], onDelete: Cascade)

  @@map("service")
}

model Client {
  id           String   @id @default(uuid())
  name         String
  email        String
  cpf          String   @unique
  phone_number String
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  services     Service[]

  @@map("client")
}

enum UserRole {
  ADMIN
  COMPANY
}

model Admin {
  id       String   @id @default(uuid())
  email    String   @unique
  password String
  role     UserRole @default(ADMIN)

  @@map("admin")
}